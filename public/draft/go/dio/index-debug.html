<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ‡ã‚£ã‚ªã‚¯ãƒªãƒ‹ãƒƒã‚¯å…¬å¼ã‚µã‚¤ãƒˆã¸ç§»å‹•ä¸­...</title>
    <meta name="description" content="ãƒ‡ã‚£ã‚ªã‚¯ãƒªãƒ‹ãƒƒã‚¯ã®å…¬å¼ã‚µã‚¤ãƒˆã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ã„ã¾ã™ã€‚">
    <!-- ãƒªãƒ•ã‚¡ãƒ©ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’æ˜ç¤ºçš„ã«è¨­å®šï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å«ã‚€å®Œå…¨URLé€ä¿¡ï¼‰ -->
    <meta name="referrer" content="unsafe-url">
    <!-- è¿½åŠ ã®ãƒªãƒ•ã‚¡ãƒ©ãƒ¼å¼·åˆ¶é€ä¿¡è¨­å®š -->
    <meta http-equiv="Content-Security-Policy" content="referrer unsafe-url">
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <!-- Analytics -->
    <script src="/analytics.js"></script>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9f2f9 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            color: #333;
        }
        .redirect-container {
            text-align: center;
            padding: 40px;
            max-width: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        .clinic-logo {
            width: 200px;
            height: auto;
            margin-bottom: 20px;
        }
        .redirect-message {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4bc0c0;
        }
        .redirect-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .loading-animation {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4bc0c0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .manual-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: #4bc0c0;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .manual-link:hover {
            background: #3da9a9;
        }
        .countdown {
            font-size: 16px;
            color: #666;
            margin-top: 10px;
        }
        .debug-log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: left;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .debug-log h3 {
            margin-top: 0;
            color: #495057;
        }
        .debug-log .log-entry {
            margin: 5px 0;
            padding: 5px;
            background: #ffffff;
            border-radius: 4px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="redirect-container">
        <img src="/images/clinics/dio/dio-logo.webp" alt="ãƒ‡ã‚£ã‚ªã‚¯ãƒªãƒ‹ãƒƒã‚¯" class="clinic-logo">
        <div class="loading-animation"></div>
        <h1 class="redirect-message">ãƒ‡ã‚£ã‚ªã‚¯ãƒªãƒ‹ãƒƒã‚¯å…¬å¼ã‚µã‚¤ãƒˆã¸ç§»å‹•ä¸­...</h1>
        <p class="redirect-description">
            ã¾ã‚‚ãªãè‡ªå‹•çš„ã«ãƒ‡ã‚£ã‚ªã‚¯ãƒªãƒ‹ãƒƒã‚¯ã®å…¬å¼ã‚µã‚¤ãƒˆã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚<br>
            ç§»å‹•ã—ãªã„å ´åˆã¯ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
        </p>
        <div class="countdown" id="countdown">3ç§’å¾Œã«ç§»å‹•ã—ã¾ã™...</div>
        <a href="#" id="manualLink" class="manual-link" style="display: none;">ãƒ‡ã‚£ã‚ªã‚¯ãƒªãƒ‹ãƒƒã‚¯å…¬å¼ã‚µã‚¤ãƒˆã¸</a>
        
        <!-- ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¡¨ç¤º -->
        <div class="debug-log" id="debugLog">
            <h3>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
        </div>
    </div>

    <!-- Centralized Clinic URLs -->
    <script src="../../config/clinic-urls.js"></script>
    
    <script>
        const debugLog = document.getElementById('debugLog');
        function addLog(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            debugLog.appendChild(entry);
        }

        addLog('ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰é–‹å§‹', 'info');
        
        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
        const urlParams = new URLSearchParams(window.location.search);
        addLog(`URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: ${window.location.search}`, 'info');
        
        // clinic-urls.jsã®èª­ã¿è¾¼ã¿ç¢ºèª
        if (window.CLINIC_URLS) {
            addLog('âœ… CLINIC_URLSãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ', 'success');
            if (window.CLINIC_URLS.dio) {
                addLog(`âœ… dioè¨­å®šãŒå­˜åœ¨: ${JSON.stringify(window.CLINIC_URLS.dio)}`, 'success');
            } else {
                addLog('âŒ dioè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        } else {
            addLog('âŒ CLINIC_URLSãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
        }
        
        // ãƒ™ãƒ¼ã‚¹URLï¼ˆä¸­å¤®ç®¡ç†ã‹ã‚‰å–å¾—ï¼‰
        const baseUrl = window.CLINIC_URLS && window.CLINIC_URLS.dio ? 
            window.CLINIC_URLS.dio.baseUrl : 
            'https://sss.ac01.l-ad.net/cl/p1a64143O61e70f7/?bid=a6640dkh37648h88&param2=ADID_PLACEHOLDER&param3=GCLID_PLACEHOLDER';
        
        addLog(`baseURL: ${baseUrl}`, 'info');
        addLog(`[GCLID_PLACEHOLDER]ã‚’å«ã‚€: ${baseUrl.includes('[GCLID_PLACEHOLDER]')}`, 'info');
        
        // gclidã‚’å–å¾—
        const gclid = urlParams.get('gclid');
        addLog(`gclid: ${gclid || 'ãªã—'}`, gclid ? 'success' : 'error');
        
        // [GCLID_PLACEHOLDER]ã‚’gclidã§ç½®æ›ï¼ˆgclidãŒã‚ã‚‹å ´åˆï¼‰
        let processedBaseUrl = baseUrl;
        if (gclid && processedBaseUrl.includes('[GCLID_PLACEHOLDER]')) {
            processedBaseUrl = processedBaseUrl.replace('[GCLID_PLACEHOLDER]', gclid);
            console.log('ğŸ”„ GCLIDç½®æ›å®Ÿè¡Œ:', gclid);
            addLog(`âœ… GCLIDç½®æ›å®Ÿè¡Œ: [GCLID_PLACEHOLDER] â†’ ${gclid}`, 'success');
        } else if (processedBaseUrl.includes('[GCLID_PLACEHOLDER]')) {
            // gclidãŒãªã„å ´åˆã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ç©ºæ–‡å­—ã§ç½®æ›
            processedBaseUrl = processedBaseUrl.replace('[GCLID_PLACEHOLDER]', '');
            addLog('âš ï¸ gclidãªã—: [GCLID_PLACEHOLDER]ã‚’ç©ºæ–‡å­—ã§ç½®æ›', 'error');
        } else {
            addLog('âš ï¸ [GCLID_PLACEHOLDER]ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
        }
        
        addLog(`å‡¦ç†å¾Œã®URL: ${processedBaseUrl}`, 'info');
        
        // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ã„ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURLã‚’æ§‹ç¯‰
        const redirectUrl = new URL(processedBaseUrl);
        
        // å…¨ã¦ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ã
        for (const [key, value] of urlParams) {
            redirectUrl.searchParams.set(key, value);
        }
        
        // region_idãŒãªã„å ´åˆã¯æ±äº¬ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        if (!redirectUrl.searchParams.has('region_id')) {
            redirectUrl.searchParams.set('region_id', '013');
        }
        
        const finalUrl = redirectUrl.toString();
        addLog(`æœ€çµ‚URL: ${finalUrl}`, 'success');
        
        // param3ã®ç¢ºèª
        if (finalUrl.includes('param3=')) {
            const param3Match = finalUrl.match(/param3=([^&]*)/);
            if (param3Match && param3Match[1]) {
                addLog(`âœ… param3ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™: ${param3Match[1]}`, 'success');
            } else {
                addLog('âš ï¸ param3ã¯ç©ºã§ã™', 'error');
            }
        } else {
            addLog('âŒ param3ãŒURLã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
        }
        
        // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸URLï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãï¼‰ã‚’ãƒ­ã‚°å‡ºåŠ›
        const currentPageWithParams = window.location.href;
        console.log('ğŸ” é€ä¿¡äºˆå®šã®ãƒªãƒ•ã‚¡ãƒ©ãƒ¼:', currentPageWithParams);
        console.log('ğŸ¯ æœ€çµ‚é·ç§»å…ˆ:', finalUrl);
        
        // æ‰‹å‹•ãƒªãƒ³ã‚¯ã«ã‚‚URLã‚’è¨­å®š
        document.getElementById('manualLink').href = finalUrl;
        
        // ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡
        if (window.trackEvent) {
            trackEvent('clinic_redirect', {
                clinic_name: 'dio',
                destination_url: finalUrl,
                source_page: document.referrer || 'direct'
            });
        }
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ©Ÿèƒ½ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã¯ç„¡åŠ¹åŒ–ï¼‰
        const countdownElement = document.getElementById('countdown');
        const manualLink = document.getElementById('manualLink');
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§ã¯è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’ç„¡åŠ¹åŒ–
        countdownElement.textContent = 'ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰: è‡ªå‹•ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã¯ç„¡åŠ¹ã§ã™';
        manualLink.style.display = 'inline-block';
    </script>
</body>
</html>